// ========================================================================
// üß≠ RoleRedirector.jsx ‚Äì Redirecci√≥n autom√°tica post-login (versi√≥n robusta)
// ========================================================================

import { useEffect } from "react";
import { useNavigate } from "react-router-dom";

export default function RoleRedirector({ roles = [] }) {
  const navigate = useNavigate();

  useEffect(() => {
    console.log("üß≠ RoleRedirector montado. Roles:", roles);

    if (!roles || roles.length === 0) {
      console.warn("‚ö†Ô∏è Sin roles a√∫n, enviando a dashboard usuario");
      navigate("/user/dashboard", { replace: true });
      return;
    }

    const normalizedRoles = roles.map((r) =>
      typeof r === "string"
        ? r.toUpperCase()
        : (r.authority || r.roleName || "").toUpperCase()
    );

    // üëë Superadmin / Admin
    if (
      normalizedRoles.includes("SUPERADMIN") ||
      normalizedRoles.includes("ADMIN") ||
      normalizedRoles.includes("ROLE_SUPERADMIN")
    ) {
      console.log("‚û°Ô∏è RoleRedirector ‚Üí /admin/dashboard");
      navigate("/admin/dashboard", { replace: true });
      return;
    }

    // ü©∫ M√©dicos y personal de salud
    if (
      normalizedRoles.some((r) =>
        [
          "MEDICO",
          "ENFERMERIA",
          "OBSTETRA",
          "LABORATORIO",
          "RADIOLOGIA",
          "FARMACIA",
          "PSICOLOGO",
          "TERAPISTA_LENG",
          "TERAPISTA_FISI",
          "NUTRICION",
        ].includes(r)
      )
    ) {
      console.log("‚û°Ô∏è RoleRedirector ‚Üí /roles/medico/dashboard");
      navigate("/roles/medico/dashboard", { replace: true });
      return;
    }

    // üóìÔ∏è Coordinadores
    if (
      normalizedRoles.includes("COORDINACION") ||
      normalizedRoles.includes("COORD_TRANSFER")
    ) {
      console.log("‚û°Ô∏è RoleRedirector ‚Üí /roles/coordinador/dashboard");
      navigate("/roles/coordinador/dashboard", { replace: true });
      return;
    }

    // üèõÔ∏è Externos
    if (
      normalizedRoles.some((r) =>
        ["INSTITUCION_EX", "ASEGURADORA", "REGULADOR"].includes(r)
      )
    ) {
      console.log("‚û°Ô∏è RoleRedirector ‚Üí /roles/externo/dashboard");
      navigate("/roles/externo/dashboard", { replace: true });
      return;
    }

    // üë§ Por defecto
    console.log("‚û°Ô∏è RoleRedirector ‚Üí /user/dashboard");
    navigate("/user/dashboard", { replace: true });
  }, [roles, navigate]);

  return null;
}