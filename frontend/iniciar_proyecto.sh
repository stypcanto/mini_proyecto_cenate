#!/bin/bash

# ========================================================================
# üöÄ Script de Inicio R√°pido - Sistema RBAC CENATE
# ========================================================================

echo "üéØ Sistema RBAC CENATE - Inicio R√°pido"
echo "========================================"
echo ""

# Colores
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Verificar directorio
if [ ! -f "package.json" ]; then
    echo "‚ùå Error: Ejecuta este script desde la carpeta frontend"
    exit 1
fi

echo -e "${BLUE}üì¶ Verificando dependencias...${NC}"
if [ ! -d "node_modules" ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  node_modules no encontrado. Instalando...${NC}"
    npm install
else
    echo -e "${GREEN}‚úÖ Dependencias OK${NC}"
fi

echo ""
echo -e "${BLUE}üîç Verificando archivos del sistema RBAC...${NC}"

# Verificar archivos clave
archivos=(
    "src/hooks/usePermissions.js"
    "src/components/security/ProtectedRoute.jsx"
    "src/components/security/PermissionGate.jsx"
    "src/components/DynamicSidebar.jsx"
    "src/components/AppLayout.jsx"
    "src/utils/rbacUtils.js"
    "src/App.js"
)

todos_ok=true
for archivo in "${archivos[@]}"; do
    if [ -f "$archivo" ]; then
        echo -e "${GREEN}‚úÖ $archivo${NC}"
    else
        echo -e "${RED}‚ùå $archivo no encontrado${NC}"
        todos_ok=false
    fi
done

echo ""

if [ "$todos_ok" = true ]; then
    echo -e "${GREEN}‚úÖ Todos los archivos del sistema RBAC est√°n presentes${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  Algunos archivos faltan${NC}"
fi

echo ""
echo -e "${BLUE}üìù Informaci√≥n del Sistema:${NC}"
echo -e "  ‚Ä¢ Frontend: React con RBAC"
echo -e "  ‚Ä¢ Backend esperado: http://localhost:8080"
echo -e "  ‚Ä¢ Documentaci√≥n: SISTEMA_RBAC_RESTAURADO.md"

echo ""
echo -e "${GREEN}üöÄ ¬øQuieres iniciar el servidor de desarrollo? (y/n)${NC}"
read -r respuesta

if [ "$respuesta" = "y" ] || [ "$respuesta" = "Y" ] || [ "$respuesta" = "yes" ]; then
    echo ""
    echo -e "${BLUE}üåê Iniciando servidor en http://localhost:3000${NC}"
    echo -e "${YELLOW}‚ö†Ô∏è  Aseg√∫rate de que el backend est√© corriendo en http://localhost:8080${NC}"
    echo ""
    npm start
else
    echo ""
    echo -e "${BLUE}üëã Para iniciar manualmente, ejecuta: ${YELLOW}npm start${NC}"
fi
