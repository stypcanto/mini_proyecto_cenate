package com.styp.cenate.repository;

import com.styp.cenate.model.Permiso;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * ðŸ§© Repositorio principal para la gestiÃ³n de permisos MBAC/RBAC.
 * Incluye bÃºsquedas por rol, usuario y detecciÃ³n de permisos activos.
 */
@Repository
public interface PermisoRepository extends JpaRepository<Permiso, Long> {

    // ============================================================
    // ðŸ”¹ Buscar permisos por ID de rol
    // ============================================================
    @Query("SELECT p FROM Permiso p WHERE p.rol.idRol = :idRol")
    List<Permiso> findByRolIdRol(@Param("idRol") Integer idRol);

    // ============================================================
    // ðŸ§© Listar permisos activos (al menos un flag booleano TRUE)
    // ============================================================
    @Query("""
           SELECT p FROM Permiso p
           WHERE p.puedeVer = true
              OR p.puedeCrear = true
              OR p.puedeActualizar = true
              OR p.puedeEliminar = true
              OR p.puedeEditar = true
              OR p.puedeExportar = true
              OR p.puedeAprobar = true
           """)
    List<Permiso> findAllActive();
}