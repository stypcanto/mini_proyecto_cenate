#!/bin/bash
# ============================================================
# üß™ CENATE API TEST COLLECTION (versi√≥n extendida)
# Autor: Styp Canto
# Fecha: $(date +"%Y-%m-%d")
# Descripci√≥n: Pruebas completas para m√≥dulos de CENATE Backend
# ============================================================

# =========================
# 1Ô∏è‚É£ Login y Token
# =========================
echo "=== üîë Autenticando usuario ==="
LOGIN_RESPONSE=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "scantor", "password": "admin123"}')

TOKEN=$(echo "$LOGIN_RESPONSE" | jq -r '.token')

if [ "$TOKEN" = "null" ] || [ -z "$TOKEN" ]; then
  echo "‚ùå Error: No se pudo obtener el token. Revisa las credenciales."
  exit 1
fi

echo "‚úÖ Token obtenido correctamente"
echo ""

# ============================================================
# 2Ô∏è‚É£ IPRESS Y ENTIDAD
# ============================================================
echo "=== üè• Listar todas las IPRESS ==="
curl -s -X GET http://localhost:8080/api/ipress \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üè• Listar IPRESS activas ==="
curl -s -X GET http://localhost:8080/api/ipress/activas \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üè• Buscar IPRESS: TARAPOTO ==="
curl -s -X GET "http://localhost:8080/api/ipress/buscar?q=TARAPOTO" \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üè• Obtener IPRESS por ID (ej. 2) ==="
curl -s -X GET http://localhost:8080/api/ipress/2 \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

# ============================================================
# 3Ô∏è‚É£ CAT√ÅLOGOS MAESTROS
# ============================================================
echo "=== üß© Tipos de IPRESS ==="
curl -s -X GET http://localhost:8080/api/tipo-ipress \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== ‚öôÔ∏è Tipos de Procedimiento ==="
curl -s -X GET http://localhost:8080/api/tipo-procedimientos \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üß± Niveles de Atenci√≥n ==="
curl -s -X GET http://localhost:8080/api/nivel-atencion \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üè¢ √Åreas Hospitalarias ==="
curl -s -X GET http://localhost:8080/api/area-hospitalaria \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

# ============================================================
# 4Ô∏è‚É£ PERSONAL CNT Y RELACIONES
# ============================================================
echo "=== üë®‚Äç‚öïÔ∏è Listar Personal CNT ==="
curl -s -X GET http://localhost:8080/api/personal-cnt \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üîç Buscar Personal CNT por DNI (ej. 12345678) ==="
curl -s -X GET "http://localhost:8080/api/personal-cnt/buscar?q=12345678" \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üë©‚Äç‚öïÔ∏è Listar Personal Externo ==="
curl -s -X GET http://localhost:8080/api/personal-externo \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üíº Listar Tipos de Personal ==="
curl -s -X GET http://localhost:8080/api/personal-tipo \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üéì Listar Profesiones ==="
curl -s -X GET http://localhost:8080/api/profesiones \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üßæ Listar Ocupaciones (OC) ==="
curl -s -X GET http://localhost:8080/api/personal-oc \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== ‚úçÔ∏è Listar Firmas Digitales ==="
curl -s -X GET http://localhost:8080/api/firmas \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

# ============================================================
# 5Ô∏è‚É£ DOCUMENTOS Y USUARIOS
# ============================================================
echo "=== ü™™ Tipos de Documento ==="
curl -s -X GET http://localhost:8080/api/tipo-documento \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üß∞ Reg√≠menes Laborales ==="
curl -s -X GET http://localhost:8080/api/regimen-laboral \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üë§ Usuarios del Sistema ==="
curl -s -X GET http://localhost:8080/api/usuarios \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

# ============================================================
# 6Ô∏è‚É£ AUDITOR√çA Y DASHBOARD
# ============================================================
echo "=== üìä Dashboard principal ==="
curl -s -X GET http://localhost:8080/api/dashboard \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

echo "=== üßæ Logs de Auditor√≠a ==="
curl -s -X GET http://localhost:8080/api/admin/audit-logs \
  -H "Authorization: Bearer $TOKEN" | jq
echo ""

# ============================================================
# 6Ô∏è‚É£ DETALLE PERSONAL
# ============================================================

echo "=== üë®‚Äç‚öïÔ∏è Consultar detalle completo del personal CNT ==="
curl -s -X GET http://localhost:8080/api/personal-cnt/detalle \
  -H "Authorization: Bearer $TOKEN" | jq


echo "‚úÖ ‚úÖ Pruebas API completadas correctamente."
