# üöÄ INICIO R√ÅPIDO: Sistema Unificado de Personal

## üìã ¬øQu√© es esto?

Un sistema que permite **diferenciar y gestionar** en un solo panel:
- **Personal Interno (CENATE)**: Empleados propios
- **Personal Externo**: Empleados de hospitales, cl√≠nicas y centros de salud

## ‚ö° Instalaci√≥n R√°pida (5 minutos)

### Paso 1: Ejecutar migraci√≥n SQL

```bash
cd backend
psql -U postgres -d cenate_db -f sql/00_migracion_sistema_unificado.sql
```

**¬øQu√© hace?**
- ‚úÖ Crea tabla `dim_ipress` (instituciones de salud)
- ‚úÖ Actualiza tabla `dim_personal_externo` con relaci√≥n a IPRESS
- ‚úÖ Inserta 14 instituciones de ejemplo
- ‚úÖ Crea √≠ndices para mejor rendimiento

### Paso 2: Recompilar el backend

```bash
# Con Gradle
./gradlew clean build

# Con Maven
mvn clean install
```

### Paso 3: Reiniciar la aplicaci√≥n

```bash
# Con Docker
docker-compose restart backend

# O directamente
./gradlew bootRun
```

### Paso 4: Probar endpoints

```bash
# Dar permisos de ejecuci√≥n
chmod +x backend/test_personal_unificado.sh

# Ejecutar pruebas (necesitas un token JWT)
./backend/test_personal_unificado.sh YOUR_JWT_TOKEN
```

## üéØ Endpoints Principales

| Endpoint | Descripci√≥n | Ejemplo |
|----------|-------------|---------|
| `GET /api/personal-unificado` | Todo el personal | Ver todos |
| `GET /api/personal-unificado/filtrar` | Filtrar por criterios | Ver ejemplos abajo |
| `GET /api/personal-unificado/cenate` | Solo CENATE | Personal interno |
| `GET /api/personal-unificado/externos` | Solo externos | Otras instituciones |
| `GET /api/personal-unificado/estadisticas` | M√©tricas | Dashboard |

### Ejemplos de Filtros

```bash
# Solo personal CENATE
/api/personal-unificado/filtrar?tipoPersonal=CENATE

# Solo personal externo
/api/personal-unificado/filtrar?tipoPersonal=EXTERNO

# Personal que cumple a√±os en junio
/api/personal-unificado/filtrar?mesCumpleanos=6

# Personal CENATE activo del √°rea 5
/api/personal-unificado/filtrar?tipoPersonal=CENATE&estado=ACTIVO&idArea=5

# Buscar "garcia"
/api/personal-unificado/filtrar?searchTerm=garcia
```

## üé® Integraci√≥n Frontend

### Opci√≥n 1: Usar componente React completo

```bash
# Copiar el componente ejemplo
cp frontend/ejemplos/PanelPersonalUnificado.tsx frontend/src/components/

# Importar en tu aplicaci√≥n
import { PanelPersonalUnificado } from '@/components/PanelPersonalUnificado';

function App() {
  return <PanelPersonalUnificado />;
}
```

### Opci√≥n 2: Llamar directamente a la API

```javascript
// Obtener todo el personal
const response = await fetch('/api/personal-unificado', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const personal = await response.json();

// Filtrar por tipo
const response = await fetch('/api/personal-unificado/filtrar?tipoPersonal=CENATE', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const personalCenate = await response.json();
```

## üìä Respuesta de la API

```json
{
  "id": 123,
  "tipoPersonal": "CENATE",  // ‚≠ê O "EXTERNO"
  "nombreCompleto": "JUAN GARCIA LOPEZ",
  "numeroDocumento": "75894621",
  "institucion": "CENATE",  // ‚≠ê O nombre de hospital
  "ipress": {  // ‚≠ê Solo para externos
    "idIpress": 1,
    "descIpress": "HOSPITAL DOS DE MAYO",
    "codIpress": "IP001"
  },
  "area": {  // ‚≠ê Solo para CENATE
    "idArea": 5,
    "descArea": "SISTEMAS"
  },
  "estado": "A",  // A/I para CENATE, ACTIVO/INACTIVO para todos
  "emailPersonal": "jgarcia@email.com",
  "telefono": "987654321"
}
```

## üîç C√≥mo Diferenciar en la UI

### Badge de Tipo

```jsx
{personal.tipoPersonal === 'CENATE' ? (
  <span className="badge badge-blue">
    üè¢ CENATE
  </span>
) : (
  <span className="badge badge-green">
    üè• EXTERNO
  </span>
)}
```

### Mostrar Instituci√≥n

```jsx
{personal.tipoPersonal === 'CENATE' ? (
  <strong>CENATE</strong>
) : (
  <div>
    {personal.institucion}
    <small>({personal.ipress?.codIpress})</small>
  </div>
)}
```

### Filtros Condicionales

```jsx
{/* Mostrar filtro de √Årea solo para CENATE */}
{filtros.tipoPersonal === 'CENATE' && (
  <select value={filtros.idArea} onChange={...}>
    <option value="">Todas las √°reas</option>
    {areas.map(area => (
      <option value={area.idArea}>{area.descArea}</option>
    ))}
  </select>
)}
```

## üì¶ Crear Personal Externo

```javascript
// POST /api/personal-externo
const nuevoExterno = {
  idTipDoc: 1,
  numDocExt: "75894621",
  nomExt: "MARIA",
  apePaterExt: "FLORES",
  apeMaterExt: "DIAZ",
  fechNaciExt: "1990-06-15",
  genExt: "F",
  movilExt: "987654321",
  emailPersExt: "mflores@hospital.gob.pe",
  idIpress: 1  // ‚≠ê ID de la instituci√≥n
};

const response = await fetch('/api/personal-externo', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(nuevoExterno)
});
```

## üè• Listar IPRESS Disponibles

```javascript
// GET /api/ipress/activas
const response = await fetch('/api/ipress/activas', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const instituciones = await response.json();

// Usar en un select
<select>
  {instituciones.map(ipress => (
    <option key={ipress.idIpress} value={ipress.idIpress}>
      {ipress.descIpress} ({ipress.codIpress})
    </option>
  ))}
</select>
```

## üìà Dashboard de Estad√≠sticas

```javascript
// GET /api/personal-unificado/estadisticas
const response = await fetch('/api/personal-unificado/estadisticas', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});

const stats = await response.json();
// {
//   totalCenate: 45,
//   totalExterno: 23,
//   totalGeneral: 68,
//   totalActivosCenate: 42,
//   totalInactivosCenate: 3
// }
```

## ‚úÖ Checklist de Implementaci√≥n

### Backend
- [x] Ejecutar script SQL de migraci√≥n
- [x] Compilar proyecto con nuevos archivos
- [x] Reiniciar aplicaci√≥n
- [x] Probar endpoints con script de prueba

### Frontend
- [ ] Copiar componente React de ejemplo
- [ ] Adaptar estilos a tu dise√±o
- [ ] Implementar llamadas a API
- [ ] Agregar filtros seg√∫n necesidades
- [ ] Implementar exportaci√≥n de datos

## üÜò Problemas Comunes

### Error: "IPRESS no encontrada"
**Soluci√≥n:** Ejecutar script SQL de migraci√≥n

### Error: "Column 'id_ipress' does not exist"
**Soluci√≥n:** 
```sql
ALTER TABLE dim_personal_externo 
ADD COLUMN id_ipress INTEGER REFERENCES dim_ipress(id_ipress);
```

### Los filtros no funcionan
**Soluci√≥n:** Verificar que los par√°metros sean correctos:
- `tipoPersonal`: "CENATE" o "EXTERNO" (case-sensitive)
- `mesCumpleanos`: n√∫mero 1-12
- `estado`: "ACTIVO", "INACTIVO", "A", o "I"

### No se muestran datos
**Soluci√≥n:** 
1. Verificar que el token JWT sea v√°lido
2. Verificar que existan datos en las tablas
3. Revisar logs del backend

## üìö Documentaci√≥n Completa

Para m√°s detalles, ver:
- **[GUIA_SISTEMA_PERSONAL_UNIFICADO.md](./GUIA_SISTEMA_PERSONAL_UNIFICADO.md)** - Documentaci√≥n completa
- **backend/sql/** - Scripts SQL
- **frontend/ejemplos/** - Componentes React de ejemplo

## üéØ Pr√≥ximos Pasos

1. ‚úÖ **Implementar en desarrollo** - Seguir esta gu√≠a
2. ‚úÖ **Probar funcionalidad** - Usar script de prueba
3. ‚úÖ **Adaptar UI** - Usar componentes de ejemplo
4. ‚úÖ **Capacitar usuarios** - Explicar diferencia CENATE vs Externo
5. ‚úÖ **Monitorear uso** - Ver estad√≠sticas

## üí¨ Soporte

¬øProblemas? Revisa:
1. Esta gu√≠a de inicio r√°pido
2. La gu√≠a completa
3. Los logs del backend (`logs/application.log`)
4. Los ejemplos de c√≥digo en `frontend/ejemplos/`

---

**√öltima actualizaci√≥n:** Octubre 2025  
**Versi√≥n:** 1.0.0  
**Estado:** ‚úÖ Producci√≥n lista
